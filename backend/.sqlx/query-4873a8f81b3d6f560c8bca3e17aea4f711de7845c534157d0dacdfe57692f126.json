{
  "db_name": "PostgreSQL",
  "query": "\n            WITH latest_metrics AS (\n                SELECT \n                    COALESCE(cumulative_event_count, 0) AS prev_event_count,\n                    COALESCE(cumulative_transfer_amount, 0) AS prev_transfer_amount,\n                    COALESCE(unique_account_count, 0) AS prev_unique_count\n                FROM metrics_plt \n                ORDER BY event_timestamp DESC \n                LIMIT 1\n            )\n            INSERT INTO metrics_plt (\n                event_timestamp, \n                cumulative_event_count,\n                cumulative_transfer_amount,\n                unique_account_count\n            )\n            SELECT \n                $1,\n                lm.prev_event_count,\n                lm.prev_transfer_amount,\n                GREATEST(lm.prev_unique_count - 1, 0)\n            FROM latest_metrics lm\n            ON CONFLICT (event_timestamp) DO UPDATE SET\n                unique_account_count = GREATEST(metrics_plt.unique_account_count, EXCLUDED.unique_account_count)\n            ",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Timestamptz"
      ]
    },
    "nullable": []
  },
  "hash": "4873a8f81b3d6f560c8bca3e17aea4f711de7845c534157d0dacdfe57692f126"
}
