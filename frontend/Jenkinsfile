// Params in JobDSL file
// 'https://gitlab.com/Concordium/infra/jenkins-jobs/-/blob/master/ccdscan_frontend.groovy':
// - VERSION
// - TARGET_NET
pipeline {
  agent any
  stages {
    stage('dockerhub-login') {
      environment {
        CRED = credentials('jenkins-dockerhub')
      }
      steps {
        sh 'echo $CRED_PSW | docker login --username $CRED_USR --password-stdin'
      }
    }
    stage('build') {
			environment {
				image_repo = 'concordium/ccdscan-frontend'
				image_name = "${image_repo}:${image_tag}"
			}
      steps {
        sh '''\
          docker build \
            --build-arg ENVIRONMENT=${TARGET_NET} \
            -f "frontend/Dockerfile" \
            -t "$image_name" \
            ./frontend
        '''.stripIndent()
      }
    }
    stage('push') {
      steps {
        sh 'docker push "$image_name"'
      }
    }
  }
}
